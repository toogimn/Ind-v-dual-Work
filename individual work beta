import json

gradebook = []
language = "EN"  # Default language


def _(az, en):
    return az if language == "AZ" else en


def authenticate():
    password = input("ğŸ” Enter password / Parolu daxil et: ")
    if password != "1234":
        print("âŒ Wrong password! / Parol yanlÄ±ÅŸdÄ±r!")
        exit()


def choose_language():
    global language
    lang = input("ğŸŒ Choose language (AZ / EN): ").strip().upper()
    if lang in ["AZ", "EN"]:
        language = lang
    else:
        print("â— Invalid choice. Defaulting to English.")
        language = "EN"


def load_from_file():
    global gradebook
    try:
        with open("gradebook.json", "r") as f:
            gradebook = json.load(f)
        print(_("âœ… MÉ™lumatlar yÃ¼klÉ™ndi.", "âœ… Data loaded."))
    except:
        gradebook = []
        print(_("âš  Fayl tapÄ±lmadÄ±, yeni baÅŸlanÄ±r.", "âš  File not found, starting fresh."))

def save_to_file():
    with open("gradebook.json", "w") as f:
        json.dump(gradebook, f)
    print(_("ğŸ’¾ Fayla yazÄ±ldÄ±.\n", "ğŸ’¾ Saved to file.\n"))


def main_menu():
    print(_("""\
========= QiymÉ™t KitabÃ§asÄ± Menyusu =========
1. Yeni TÉ™lÉ™bÉ™ ÆlavÉ™ Et
2. BÃ¼tÃ¼n QeydlÉ™ri GÃ¶stÉ™r
3. AxtarÄ±ÅŸ
4. YenilÉ™
5. Sil
6. Statistikalar
7. Fayla Yaz
8. Fayldan Oxu
9. Rekursiv Say
10. TÉ™limat
11. BÃ¼tÃ¼n MÉ™lumatÄ± Sil
0. Ã‡Ä±xÄ±ÅŸ
============================================""", """\
========= Grade Book Menu =========
1. Add New Record
2. View All Records
3. Search Record
4. Update Record
5. Delete Record
6. Summary Statistics
7. Save to File
8. Load from File
9. Recursive Count
10. Help / Instructions
11. Clear All Data
0. Exit
==================================="""))

def add_record():
    name = input(_("TÉ™lÉ™bÉ™ adÄ± daxil edin: ", "Enter student name: "))
    grades = []
    while True:
        grade = input(_("QiymÉ™t daxil et (Ã§Ä±xmaq Ã¼Ã§Ã¼n q): ", "Enter grade (or 'q' to quit): "))
        if grade.lower() == 'q':
            break
        try:
            grades.append(float(grade))
        except ValueError:
            print(_("YanlÄ±ÅŸ qiymÉ™t!", "Invalid grade!"))
    gradebook.append({"name": name, "grades": grades})
    save_to_file()
    print(_("âœ… Qeyd É™lavÉ™ olundu.\n", "âœ… Record added.\n"))

def view_records():
    if not gradebook:
        print(_("ğŸš« HeÃ§ bir qeyd yoxdur.\n", "ğŸš« No records available.\n"))
        return
    for i, student in enumerate(gradebook, 1):
        grades = student['grades']
        avg = sum(grades)/len(grades) if grades else 0
        print(f"{i}. {student['name']} - {grades} | {_('Orta:', 'Average:')} {avg:.2f}")
    print()

def search_record():
    name = input(_("AxtarÄ±lacaq ad: ", "Enter name to search: "))
    found = False
    for student in gradebook:
        if name.lower() in student['name'].lower():
            print(f"ğŸ” {student['name']} - {student['grades']}")
            found = True
    if not found:
        print(_("âŒ TÉ™lÉ™bÉ™ tapÄ±lmadÄ±.\n", "âŒ Student not found.\n"))

def update_record():
    name = input(_("YenilÉ™nÉ™cÉ™k tÉ™lÉ™bÉ™nin adÄ±: ", "Enter student name to update: "))
    for student in gradebook:
        if student['name'].lower() == name.lower():
            print(f"{_('Cari qiymÉ™tlÉ™r:', 'Current grades:')} {student['grades']}")
            new_grades = []
            while True:
                grade = input(_("Yeni qiymÉ™t (Ã§Ä±xmaq Ã¼Ã§Ã¼n q): ", "Enter new grade (or 'q' to quit): "))
                if grade.lower() == 'q':
                    break
                try:
                    new_grades.append(float(grade))
                except ValueError:
                    print(_("YanlÄ±ÅŸ qiymÉ™t!", "Invalid grade!"))
            student['grades'] = new_grades
            save_to_file()
            print(_("âœ… YenilÉ™ndi.\n", "âœ… Grades updated.\n"))
            return
    print(_("âŒ TÉ™lÉ™bÉ™ tapÄ±lmadÄ±.\n", "âŒ Student not found.\n"))

def delete_record():
    name = input(_("SilinÉ™cÉ™k ad: ", "Enter student name to delete: "))
    for i, student in enumerate(gradebook):
        if student['name'].lower() == name.lower():
            gradebook.pop(i)
            save_to_file()
            print(_("ğŸ—‘ TÉ™lÉ™bÉ™ silindi.\n", "ğŸ—‘ Student deleted.\n"))
            return
    print(_("âŒ TÉ™lÉ™bÉ™ tapÄ±lmadÄ±.\n", "âŒ Student not found.\n"))

def summary_stats():
    if not gradebook:
        print(_("ğŸš« HeÃ§ bir qeyd yoxdur.\n", "ğŸš« No records available.\n"))
        return
    for student in gradebook:
        if student['grades']:
            avg = sum(student['grades']) / len(student['grades'])
            print(f"{student['name']} - {_('Orta:', 'Average:')} {avg:.2f}")
        else:
            print(f"{student['name']} {_('qiymÉ™ti yoxdur.', 'has no grades.')}")
    print()

def recursive_count(index=0):
    if index >= len(gradebook):
        return 0
    return 1 + recursive_count(index + 1)

def help_menu():
    print(_("""ğŸ“– TÉ™limat:
- TÉ™lÉ™bÉ™lÉ™ri vÉ™ onlarÄ±n qiymÉ™tlÉ™rini É™lavÉ™ et
- Axtar, sil, yenilÉ™ vÉ™ bax
- Fayla saxla vÉ™ fayldan yÃ¼klÉ™
- Orta qiymÉ™tlÉ™ri gÃ¶stÉ™r
""", """
ğŸ“– Instructions:
- Add students and their grades
- View, search, update or delete records
- Save/load from file
- See average statistics
"""))

def clear_all_data():
    confirm = input(_("BÃ¼tÃ¼n mÉ™lumatÄ± silmÉ™k istÉ™diyinizÉ™ É™minsiniz? (bÉ™li/xeyr): ", "Are you sure you want to clear all data? (yes/no): "))
    if confirm.lower() in ["bÉ™li", "yes"]:
        gradebook.clear()
        save_to_file()
        print(_("ğŸ§¹ BÃ¼tÃ¼n mÉ™lumat silindi.\n", "ğŸ§¹ All data cleared.\n"))
    else:
        print(_("âŒ LÉ™ÄŸv edildi.\n", "âŒ Cancelled.\n"))


def main():
    authenticate()
    choose_language()
    load_from_file()

    while True:
        main_menu()
        choice = input(_("SeÃ§iminizi daxil edin: ", "Enter your choice: "))
        match choice:
            case "1": add_record()
            case "2": view_records()
            case "3": search_record()
            case "4": update_record()
            case "5": delete_record()
            case "6": summary_stats()
            case "7": save_to_file()
            case "8": load_from_file()
            case "9": print(f"{_('Ãœmumi qeyd sayÄ±:', 'Total records:')} {recursive_count()}\n")
            case "10": help_menu()
            case "11": clear_all_data()
            case "0":
                save_to_file()
                print(_("ğŸ“¤ Ã‡Ä±xÄ±lÄ±r... HÉ™lÉ™lik!", "ğŸ“¤ Exiting... Goodbye!"))
                break
            case _: print(_("âŒ YanlÄ±ÅŸ seÃ§im.\n", "âŒ Invalid option.\n"))

if __name__ == "__main__":
    main()
